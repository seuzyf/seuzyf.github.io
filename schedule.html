<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HWVCTS4 - 赛程中心</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700;900&display=swap">
    <style>
        :root {
            --primary-color: #D64550;
            --bg-color: rgba(15, 25, 35, 0.85);
            --text-color: #ece8e1;
            --card-bg-color: rgba(26, 40, 54, 0.8);
            --header-bg-color: rgba(26, 40, 54, 0.85);
            --border-color: #2a3a49;
            --winner-color: #4CAF50;
            --loser-color: #F44336;
            --shadow-color: rgba(0,0,0,0.3);
            --control-height: 42px;
        }
        body.light-theme {
            --primary-color: #D64550;
            --bg-color: rgba(240, 242, 245, 0.85);
            --text-color: #1c1e21;
            --card-bg-color: rgba(255, 255, 255, 0.8);
            --header-bg-color: rgba(255, 255, 255, 0.85);
            --border-color: #dadde1;
            --shadow-color: rgba(0,0,0,0.1);
        }
        body {
            font-family: 'Roboto', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 20px 0;
            line-height: 1.6;
            transition: background-color 0.3s, color 0.3s;
            background-image: url('https://cdnb.artstation.com/p/assets/images/images/090/820/719/large/envar-studio-valorantact4kv3-render-17-fd-ot-gis-jett-2.jpg?1755007158');
            background-attachment: fixed;
            background-size: cover;
            background-position: center center;
            background-repeat: no-repeat;
        }
        .container { width: 90%; max-width: 1400px; margin: 0 auto; }
        
        .main-header-block {
            background-color: var(--header-bg-color);
            backdrop-filter: blur(10px);
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 8px 16px var(--shadow-color);
            text-align: center;
            margin-bottom: 40px;
            border: 1px solid var(--border-color);
            position: relative;
        }
        .main-header-block h1 { color: var(--primary-color); margin: 0 0 10px 0; font-weight: 700; font-size: 2.5em; }
        .controls-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
            margin-top: 25px;
        }
        .filter-group, .nav-button {
            height: var(--control-height);
            display: inline-flex;
            align-items: center;
            border-radius: 8px;
            font-weight: 500;
        }
        .filter-group { background-color: var(--card-bg-color); padding: 5px; border: 1px solid var(--border-color); }
        .filter-group button { padding: 0 15px; border: none; background-color: transparent; color: var(--text-color); opacity: 0.7; cursor: pointer; border-radius: 6px; font-size: 0.9em; height: 100%; transition: background-color 0.3s, color 0.3s; }
        .filter-group button.active { background-color: var(--primary-color); color: white; opacity: 1; }
        .nav-button { padding: 0 25px; border: 2px solid var(--primary-color); color: var(--primary-color); text-decoration: none; transition: background-color 0.3s, color 0.3s; }
        .nav-button:hover { background-color: var(--primary-color); color: white; }

        .content-block {
            background-color: var(--card-bg-color);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 8px 16px var(--shadow-color);
        }
        .content-block h3 {
            text-align: center;
            font-size: 1.5em;
            color: var(--text-color);
            opacity: 0.9;
            margin-top: 0;
            margin-bottom: 20px;
        }
        .bracket-container {
            width: 100%;
            overflow-x: auto;
            padding-bottom: 15px;
        }
        .bracket {
            display: flex;
            justify-content: center;
            gap: 40px;
            min-width: max-content;
            padding: 20px;
            position: relative;
        }
        .round {
            display: flex;
            flex-direction: column;
            gap: 20px;
            justify-content: center;
            flex-shrink: 0;
            width: 190px;
        }
        .round-title {
            text-align: center;
            color: var(--primary-color);
            font-weight: bold;
            font-size: 1.1em;
            margin-bottom: 5px;
        }
        .match-card, .result-card {
            background-color: var(--bg-color);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 10px;
            width: 100%;
            box-shadow: 0 2px 8px var(--shadow-color);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .match-card.clickable:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px var(--shadow-color);
        }
        .team { display: flex; justify-content: space-between; align-items: center; padding: 2px 0; }
        .team-name { font-size: 1em; }
        .team-score { font-weight: bold; }
        .team.winner .team-name { color: var(--winner-color); }
        .team.loser .team-name { opacity: 0.6; }
        hr { border-color: var(--border-color); margin: 5px 0; }
        .result-card {
            border-width: 2px;
            text-align: center;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 50px;
        }
        .promoted { border-color: var(--winner-color); }
        .champion { border-color: var(--winner-color); font-size: 1.5em; background-color: rgba(76, 175, 80, 0.1); }
        .eliminated { border-color: var(--loser-color); opacity: 0.8; }
        
        .theme-switch-wrapper { position: absolute; top: 20px; right: 20px; display: flex; align-items: center; gap: 10px; }
        #theme-text { font-size: 0.8em; opacity: 0.8; }
        .theme-switch { display: inline-block; height: 24px; position: relative; width: 48px; }
        .theme-switch input { display:none; }
        .slider { background-color: var(--border-color); bottom: 0; cursor: pointer; left: 0; position: absolute; right: 0; top: 0; transition: .4s; border-radius: 24px; }
        .slider:before { background-color: var(--text-color); bottom: 4px; content: ""; height: 16px; left: 4px; position: absolute; transition: .4s; width: 16px; border-radius: 50%; }
        input:checked + .slider { background-color: var(--primary-color); }
        input:checked + .slider:before { transform: translateX(24px); }
    </style>
</head>
<body>
    <div class="container">
        <div class="main-header-block">
            <div class="theme-switch-wrapper">
                <span id="theme-text"></span>
                <label class="theme-switch">
                    <input type="checkbox" id="theme-toggle-checkbox">
                    <span class="slider"></span>
                </label>
            </div>
            <h1>HWVCTS4 赛程中心</h1>
            <div class="controls-container">
                <a href="index.html" class="nav-button">返回比赛中心</a>
                <a href="summary.html" class="nav-button" target="_blank">查看选手数据</a>
            </div>
            <div class="controls-container" style="margin-top: 20px;">
                 <div class="filter-group" id="group-filters">
                    <button class="active" data-group="传奇组">传奇组</button>
                    <button data-group="中坚组">中坚组</button>
                    <button data-group="挑战组">挑战组</button>
                </div>
                <div class="filter-group" id="stage-filters">
                    <button class="active" data-stage="swiss">小组赛</button>
                    <button data-stage="playoff">淘汰赛</button>
                </div>
            </div>
        </div>

        <main class="content-block">
            <h2 id="current-group-name"></h2>
            <div id="swiss-stage-section">
                <h3>小组赛 (瑞士轮)</h3>
                <div class="bracket-container">
                    <div id="swiss-bracket" class="bracket"></div>
                </div>
            </div>
            <div id="playoff-stage-section" style="display: none;">
                <h3>淘汰赛 (双败)</h3>
                <div class="bracket-container">
                    <div id="playoff-bracket" class="bracket"></div>
                </div>
            </div>
        </main>
    </div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        // ... (除了 buildBracket 和新增的 bracket event listener 之外的 JS 逻辑与上一版本完全相同) ...
        
        function buildBracket(container, layout, data) {
            container.innerHTML = '';
            layout.forEach(col => {
                const roundDiv = document.createElement('div');
                roundDiv.className = 'round';
                col.content.forEach(group => {
                    const titleDiv = document.createElement('div');
                    titleDiv.className = 'round-title';
                    titleDiv.textContent = group.title;
                    roundDiv.appendChild(titleDiv);
                    group.ids.forEach(id => {
                        const cardData = data[id];
                        const cardWrapper = document.createElement('div');
                        
                        // 检查是否有link，并相应地设置
                        if (cardData && cardData.link) {
                            cardWrapper.dataset.link = cardData.link;
                            cardWrapper.classList.add('clickable');
                            cardWrapper.style.cursor = 'pointer';
                        }
                        
                        let cardHtml = '';
                        if (group.type) {
                            cardHtml = createResultCard(cardData, group.type);
                        } else {
                            cardHtml = createMatchCard(cardData);
                        }
                        cardWrapper.innerHTML = cardHtml;
                        roundDiv.appendChild(cardWrapper.firstElementChild); // 添加卡片本身
                    });
                });
                container.appendChild(roundDiv);
            });
        }

        // 新增：为两个bracket容器添加统一的事件监听
        document.querySelectorAll('.bracket').forEach(bracket => {
            bracket.addEventListener('click', e => {
                const clickableCard = e.target.closest('.match-card.clickable');
                if (clickableCard && clickableCard.dataset.link) {
                    window.open(clickableCard.dataset.link, '_blank');
                }
            });
        });

        loadData();
    });
</script>

</body>
</html>